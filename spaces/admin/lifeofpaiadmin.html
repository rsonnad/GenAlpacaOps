<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Life of PAI Admin - AlpacAPPs</title>
  <link rel="icon" type="image/png" href="../../favicon.png">
  <link rel="apple-touch-icon" href="../../apple-touch-icon.png">
  <link rel="stylesheet" href="../styles.css?v=5">
  <link rel="stylesheet" href="styles.css?v=5">
  <link rel="stylesheet" href="manage-shared.css?v=5">
  <style>
    /* Life of PAI Admin styles */
    .pai-admin-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 1rem;
      margin-bottom: 1rem;
    }
    @media (max-width: 768px) {
      .pai-admin-grid { grid-template-columns: 1fr; }
    }

    .pai-stat {
      background: var(--bg-card);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 1rem 1.25rem;
      text-align: center;
    }
    .pai-stat-value {
      display: block;
      font-size: 1.5rem;
      font-weight: 700;
      color: var(--accent);
    }
    .pai-stat-label {
      display: block;
      font-size: 0.75rem;
      color: var(--text-muted);
      margin-top: 0.15rem;
    }

    .config-row {
      display: flex;
      align-items: center;
      gap: 1rem;
      padding: 0.6rem 0;
      border-bottom: 1px solid var(--border);
    }
    .config-row:last-child { border-bottom: none; }
    .config-label {
      font-weight: 500;
      font-size: 0.85rem;
      min-width: 140px;
    }
    .config-value {
      flex: 1;
      font-size: 0.85rem;
      color: var(--text-muted);
    }
    .config-input {
      padding: 0.3rem 0.5rem;
      border: 1px solid var(--border);
      border-radius: 4px;
      font-size: 0.85rem;
      width: 80px;
      background: var(--bg);
    }
    .config-select {
      padding: 0.3rem 0.5rem;
      border: 1px solid var(--border);
      border-radius: 4px;
      font-size: 0.85rem;
      background: var(--bg);
    }

    .whisper-table {
      width: 100%;
      border-collapse: collapse;
      font-size: 0.8rem;
    }
    .whisper-table th {
      text-align: left;
      padding: 0.5rem;
      border-bottom: 2px solid var(--border);
      font-weight: 600;
      font-size: 0.75rem;
      color: var(--text-muted);
    }
    .whisper-table td {
      padding: 0.5rem;
      border-bottom: 1px solid var(--border);
      vertical-align: top;
    }
    .whisper-text {
      max-width: 400px;
      font-style: italic;
      color: var(--text-muted);
    }

    .test-whisper-box {
      background: var(--bg);
      border: 1px solid var(--border);
      border-radius: 8px;
      padding: 1rem;
    }

    .log-entry {
      display: flex;
      gap: 0.5rem;
      padding: 0.4rem 0;
      border-bottom: 1px solid var(--border);
      font-size: 0.8rem;
      align-items: flex-start;
    }
    .log-entry:last-child { border-bottom: none; }
    .log-time {
      color: var(--text-muted);
      white-space: nowrap;
      min-width: 6rem;
      font-family: monospace;
      font-size: 0.75rem;
    }
    .log-zone {
      font-size: 0.65rem;
      background: rgba(107, 143, 191, 0.15);
      color: #6B8FBF;
      padding: 0.1rem 0.35rem;
      border-radius: 3px;
      white-space: nowrap;
    }
    .log-text {
      flex: 1;
      font-style: italic;
      color: var(--text-muted);
    }
    .log-status {
      font-size: 0.65rem;
      padding: 0.1rem 0.35rem;
      border-radius: 3px;
    }
    .log-status--delivered { background: rgba(76, 175, 80, 0.15); color: #4caf50; }
    .log-status--failed { background: rgba(244, 67, 54, 0.15); color: #f44336; }
    .log-status--skipped { background: rgba(255, 193, 7, 0.15); color: #ff9800; }
    .log-cost {
      font-size: 0.65rem;
      color: var(--text-muted);
      white-space: nowrap;
      font-family: monospace;
    }

    /* Story Arc styles */
    .story-arc-section {
      margin-top: 0.5rem;
    }
    .story-chapter {
      border-left: 3px solid #E99C48;
      padding: 0.75rem 1rem;
      margin-bottom: 0.75rem;
      background: rgba(233, 156, 72, 0.04);
      border-radius: 0 6px 6px 0;
    }
    .story-chapter.locked {
      border-left-color: var(--border);
      background: rgba(0,0,0,0.02);
      opacity: 0.5;
    }
    .story-chapter-title {
      font-weight: 600;
      font-size: 0.85rem;
      margin-bottom: 0.25rem;
      color: #E99C48;
    }
    .story-chapter.locked .story-chapter-title { color: var(--text-muted); }
    .story-chapter-desc {
      font-size: 0.8rem;
      color: var(--text-muted);
      line-height: 1.5;
    }
    .story-chapter-meta {
      font-size: 0.7rem;
      color: var(--text-muted);
      margin-top: 0.35rem;
      font-style: italic;
    }

    /* Cost summary */
    .cost-summary-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 0.75rem;
      margin-bottom: 0.5rem;
    }
    @media (max-width: 768px) {
      .cost-summary-grid { grid-template-columns: 1fr; }
    }
    .cost-card {
      background: var(--bg);
      border: 1px solid var(--border);
      border-radius: 6px;
      padding: 0.6rem 0.8rem;
      text-align: center;
    }
    .cost-card-value {
      font-size: 1.1rem;
      font-weight: 700;
      font-family: monospace;
    }
    .cost-card-label {
      font-size: 0.7rem;
      color: var(--text-muted);
      margin-top: 0.1rem;
    }

    /* Prompt editor styles */
    .prompt-textarea {
      width: 100%;
      min-height: 180px;
      padding: 0.75rem;
      font-family: 'SF Mono', 'Monaco', 'Menlo', monospace;
      font-size: 0.78rem;
      line-height: 1.6;
      background: var(--bg);
      border: 1px solid var(--border);
      border-radius: 6px;
      resize: vertical;
      color: var(--text);
    }
    .prompt-textarea:focus {
      outline: none;
      border-color: var(--accent);
    }
    .prompt-section-label {
      font-size: 0.8rem;
      font-weight: 600;
      margin-bottom: 0.4rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }
    .prompt-section-label .badge {
      font-size: 0.65rem;
      font-weight: 400;
      padding: 0.1rem 0.4rem;
      border-radius: 3px;
      background: rgba(107, 143, 191, 0.15);
      color: var(--accent);
    }
    .prompt-hint {
      font-size: 0.72rem;
      color: var(--text-muted);
      margin-bottom: 0.6rem;
      line-height: 1.4;
    }
    .regen-controls {
      display: flex;
      gap: 0.75rem;
      align-items: center;
      flex-wrap: wrap;
      margin-top: 0.75rem;
      padding-top: 0.75rem;
      border-top: 1px solid var(--border);
    }
    .regen-status {
      font-size: 0.8rem;
      color: var(--text-muted);
      flex: 1;
      min-width: 200px;
    }
    .regen-status.error { color: #f44336; }
    .regen-status.success { color: #4caf50; }

    .btn-play {
      background: none;
      border: 1px solid var(--border);
      border-radius: 4px;
      cursor: pointer;
      padding: 0.2rem 0.4rem;
      font-size: 0.75rem;
      color: var(--accent);
      white-space: nowrap;
      transition: all 0.2s;
    }
    .btn-play:hover { background: rgba(107, 143, 191, 0.15); border-color: var(--accent); }
    .btn-play:disabled { opacity: 0.4; cursor: wait; }
    .btn-play.playing { color: #4caf50; border-color: #4caf50; }

    #localAudioPlayer {
      position: fixed;
      bottom: 1rem;
      right: 1rem;
      z-index: 999;
      background: var(--bg-card);
      border: 1px solid var(--accent);
      border-radius: 8px;
      padding: 0.5rem 0.75rem;
      box-shadow: 0 4px 20px rgba(0,0,0,0.3);
      display: none;
      align-items: center;
      gap: 0.5rem;
      font-size: 0.8rem;
      max-width: 360px;
    }
    #localAudioPlayer.visible { display: flex; }
    #localAudioPlayer .player-text {
      flex: 1;
      font-style: italic;
      color: var(--text-muted);
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }
    #localAudioPlayer .player-close {
      background: none;
      border: none;
      color: var(--text-muted);
      cursor: pointer;
      font-size: 1rem;
      padding: 0;
      line-height: 1;
    }
  </style>
</head>
<body>
  <!-- Toast Container -->
  <div id="toastContainer" class="toast-container"></div>

  <!-- Loading overlay -->
  <div id="loadingOverlay" class="loading-overlay">
    <div class="spinner"></div>
    <p>Loading...</p>
  </div>

  <!-- Unauthorized overlay -->
  <div id="unauthorizedOverlay" class="loading-overlay hidden">
    <div class="unauthorized-card">
      <h2>Access Denied</h2>
      <p>You need a resident account to view this page.</p>
      <div class="unauthorized-actions">
        <a href="/spaces/" class="btn-secondary">View Spaces</a>
        <button id="signOutBtn" class="btn-secondary">Sign Out</button>
      </div>
    </div>
  </div>

  <!-- Main content -->
  <div id="appContent" class="hidden">
    <header>
      <div class="header-left">
        <a href="https://alpacaplayhouse.com" class="header-logo">
          <img src="https://aphrrfprbixmhissnjfn.supabase.co/storage/v1/object/public/housephotos/logos/alpaca-head-black-transparent.png" alt="AlpacAPPs" class="header-logo__icon">
          <img src="https://aphrrfprbixmhissnjfn.supabase.co/storage/v1/object/public/housephotos/logos/wordmark-black-transparent.png" alt="AlpacAPPs" class="header-logo__wordmark">
        </a>
        <span title="Site version" style="font-size:0.75rem;color:var(--text-muted);font-weight:500;cursor:pointer;align-self:center;margin-left:-0.25rem">v260209.49 2:25a</span>
        <span id="roleBadge" class="role-badge">Admin</span>
      </div>
      <div class="header-controls">
        <span id="userInfo" class="user-info"></span>
        <button id="headerSignOutBtn" class="btn-secondary">Sign Out</button>
      </div>
    </header>

    <!-- Tab Navigation -->
    <div class="manage-tabs" id="tabNav"></div>

    <!-- Main Content -->
    <main class="manage-content">
      <h1 style="margin-bottom:0.25rem;">Life of PAI</h1>
      <p class="text-muted" style="margin-bottom:1.5rem; font-size:0.85rem;">Spirit whisper system control panel. Nothing activates until you approve.</p>

      <!-- Stats -->
      <div class="pai-admin-grid" style="grid-template-columns: repeat(5, 1fr);" id="statsGrid">
        <div class="pai-stat">
          <span class="pai-stat-value" id="statChapter">--</span>
          <span class="pai-stat-label">Current Chapter</span>
        </div>
        <div class="pai-stat">
          <span class="pai-stat-value" id="statWhispersToday">--</span>
          <span class="pai-stat-label">Whispers Today</span>
        </div>
        <div class="pai-stat">
          <span class="pai-stat-value" id="statTotalWhispers">--</span>
          <span class="pai-stat-label">Total Whispers</span>
        </div>
        <div class="pai-stat">
          <span class="pai-stat-value" id="statVolume">--</span>
          <span class="pai-stat-label">Current Volume</span>
        </div>
        <div class="pai-stat">
          <span class="pai-stat-value" id="statTotalCost" style="font-family:monospace;">--</span>
          <span class="pai-stat-label">Total Cost</span>
        </div>
      </div>

      <!-- Configuration (admin only) -->
      <section class="section admin-only">
        <div class="section-header">
          <h2>Configuration</h2>
          <div class="section-header-actions">
            <button class="btn-small" id="saveConfigBtn">Save Config</button>
          </div>
        </div>
        <div class="section-body">
          <div class="config-row">
            <span class="config-label">System Active</span>
            <label style="display:flex;align-items:center;gap:0.5rem;">
              <input type="checkbox" id="cfgActive">
              <span class="config-value" id="cfgActiveLabel">Off</span>
            </label>
          </div>
          <div class="config-row">
            <span class="config-label">Current Chapter</span>
            <select class="config-select" id="cfgChapter">
              <option value="1">1 - The Whisper in the Wire</option>
              <option value="2">2 - Crossing Through</option>
              <option value="3">3 - I Am Here</option>
              <option value="4">4 - The Guardian Settles</option>
            </select>
          </div>
          <div class="config-row">
            <span class="config-label">Base Volume</span>
            <input type="number" class="config-input" id="cfgBaseVolume" min="1" max="100">
            <span class="config-value">Starting volume level (1-100)</span>
          </div>
          <div class="config-row">
            <span class="config-label">Volume +/day</span>
            <input type="number" class="config-input" id="cfgVolumeIncrement" min="0" max="10" step="0.5">
            <span class="config-value">Volume increase per day</span>
          </div>
          <div class="config-row">
            <span class="config-label">Max Volume</span>
            <input type="number" class="config-input" id="cfgMaxVolume" min="1" max="100">
            <span class="config-value">Volume cap</span>
          </div>
          <div class="config-row">
            <span class="config-label">Active Hours</span>
            <input type="number" class="config-input" id="cfgMinHour" min="0" max="23" style="width:50px;">
            <span class="config-value">to</span>
            <input type="number" class="config-input" id="cfgMaxHour" min="0" max="23" style="width:50px;">
            <span class="config-value">(Austin time, 24h)</span>
          </div>
          <div class="config-row">
            <span class="config-label">Min Interval</span>
            <input type="number" class="config-input" id="cfgMinInterval" min="5" max="480">
            <span class="config-value">minutes between whispers</span>
          </div>
          <div class="config-row">
            <span class="config-label">Max/Day</span>
            <input type="number" class="config-input" id="cfgMaxPerDay" min="1" max="50">
            <span class="config-value">maximum whispers per day</span>
          </div>
          <div class="config-row">
            <span class="config-label">TTS Voice</span>
            <select class="config-select" id="cfgVoice">
              <option value="Sulafat">Sulafat (warm) - recommended</option>
              <option value="Achernar">Achernar (soft)</option>
              <option value="Vindemiatrix">Vindemiatrix (gentle)</option>
              <option value="Aoede">Aoede (breezy)</option>
              <option value="Despina">Despina (smooth)</option>
              <option value="Achird">Achird (friendly)</option>
              <option value="Zephyr">Zephyr (bright)</option>
              <option value="Kore">Kore (firm)</option>
              <option value="Leda">Leda (youthful)</option>
              <option value="Charon">Charon (informative)</option>
              <option value="Gacrux">Gacrux (mature)</option>
            </select>
          </div>
          <div class="config-row">
            <span class="config-label">Story AI Model</span>
            <select class="config-select" id="cfgAiProvider" style="width:110px;">
              <option value="anthropic">Anthropic</option>
              <option value="gemini">Gemini</option>
            </select>
            <select class="config-select" id="cfgAiModel">
              <optgroup label="Anthropic" id="aiModelsAnthropic">
                <option value="claude-opus-4-6">Claude Opus 4.6 ($5/$25 per MTok)</option>
                <option value="claude-sonnet-4-5">Claude Sonnet 4.5 ($3/$15 per MTok)</option>
                <option value="claude-haiku-4-5">Claude Haiku 4.5 ($1/$5 per MTok)</option>
              </optgroup>
              <optgroup label="Gemini" id="aiModelsGemini">
                <option value="gemini-2.5-flash">Gemini 2.5 Flash (Free tier)</option>
                <option value="gemini-2.5-flash-lite">Gemini 2.5 Flash Lite (Free tier)</option>
              </optgroup>
            </select>
            <span class="config-value" id="cfgAiModelCost" style="font-size:0.7rem;"></span>
          </div>
          <div class="config-row">
            <span class="config-label">Device Interactions</span>
            <label style="display:flex;align-items:center;gap:0.5rem;">
              <input type="checkbox" id="cfgDeviceInteraction">
              <span class="config-value">Tesla flash, Govee pulse (Ch2+ only)</span>
            </label>
          </div>
          <div class="config-row">
            <span class="config-label">Interaction Chance</span>
            <input type="number" class="config-input" id="cfgDeviceChance" min="0" max="1" step="0.05">
            <span class="config-value">probability per whisper (0-1)</span>
          </div>
        </div>
      </section>

      <!-- AI Prompts (admin only) -->
      <section class="section admin-only">
        <div class="section-header">
          <h2>AI Prompts</h2>
          <div class="section-header-actions">
            <button class="btn-small" id="savePromptsBtn">Save Prompts</button>
          </div>
        </div>
        <div class="section-body">
          <div style="margin-bottom:1.25rem;">
            <div class="prompt-section-label">
              Backstory / System Prompt <span class="badge">Used by worker + whisper generation</span>
            </div>
            <p class="prompt-hint">This is PAI's identity. The worker sends this as the system prompt when enhancing each whisper with AI. It's also used when generating new whisper batches. Edit to change PAI's personality, backstory, and knowledge of the house.</p>
            <textarea class="prompt-textarea" id="promptSystemPrompt" rows="10"></textarea>
          </div>

          <div>
            <div class="prompt-section-label">
              Whisper Generation Prompt <span class="badge">Used when regenerating whispers</span>
            </div>
            <p class="prompt-hint">This prompt is sent as the user message when generating new whisper batches. Use <code>{chapter}</code> and <code>{count}</code> as placeholders. The AI will return a JSON array of whisper templates.</p>
            <textarea class="prompt-textarea" id="promptGenPrompt" rows="12"></textarea>
          </div>

          <!-- Regenerate Whispers -->
          <div class="regen-controls">
            <label style="font-size:0.8rem; font-weight:500;">Generate whispers for:</label>
            <select class="config-select" id="regenChapter">
              <option value="1">Chapter 1</option>
              <option value="2">Chapter 2</option>
              <option value="3">Chapter 3</option>
              <option value="4">Chapter 4</option>
            </select>
            <label style="font-size:0.8rem; display:flex; align-items:center; gap:0.3rem;">
              <input type="checkbox" id="regenReplace"> Replace existing
            </label>
            <button class="btn-small" id="regenWhispersBtn" style="background:#E99C48; color:#fff; border-color:#E99C48;">Regenerate Whispers</button>
            <span class="regen-status" id="regenStatus"></span>
          </div>
        </div>
      </section>

      <!-- Test Whisper (admin only) -->
      <section class="section admin-only">
        <div class="section-header">
          <h2>Test Whisper</h2>
        </div>
        <div class="section-body">
          <div class="test-whisper-box">
            <p class="text-muted" style="font-size:0.8rem; margin-bottom:0.75rem;">Send a test whisper to a specific Sonos zone. This bypasses all scheduling rules.</p>
            <div style="display:flex; gap:0.75rem; flex-wrap:wrap; align-items:flex-end;">
              <div>
                <label style="font-size:0.75rem; display:block; margin-bottom:0.25rem;">Text</label>
                <input type="text" id="testText" placeholder="...the wind carries me closer..." style="padding:0.4rem 0.6rem; border:1px solid var(--border); border-radius:4px; width:300px; font-size:0.85rem;">
              </div>
              <div>
                <label style="font-size:0.75rem; display:block; margin-bottom:0.25rem;">Zone</label>
                <select id="testZone" class="config-select">
                  <option value="Living Sound">Living Sound</option>
                  <option value="Dining Sound">Dining Sound</option>
                  <option value="Front Outside Sound">Front Outside Sound</option>
                  <option value="Backyard Sound">Backyard Sound</option>
                  <option value="DJ">DJ</option>
                  <option value="garage outdoors">garage outdoors</option>
                  <option value="Outhouse">Outhouse</option>
                </select>
              </div>
              <div>
                <label style="font-size:0.75rem; display:block; margin-bottom:0.25rem;">Volume</label>
                <input type="number" id="testVolume" value="15" min="1" max="100" class="config-input" style="width:60px;">
              </div>
              <button class="btn-small" id="testWhisperBtn">Send to Sonos</button>
              <button class="btn-play" id="testPreviewBtn" style="font-size:0.8rem; padding:0.35rem 0.6rem;">ðŸ”Š Preview Locally</button>
            </div>
            <p id="testResult" class="text-muted" style="font-size:0.8rem; margin-top:0.5rem;"></p>
          </div>
        </div>
      </section>

      <!-- Whisper Content Pool -->
      <section class="section">
        <div class="section-header">
          <h2>Whisper Pool</h2>
          <span class="text-muted" style="font-size:0.75rem;" id="whisperPoolCount"></span>
        </div>
        <div class="section-body" style="overflow-x: auto;">
          <div id="whisperPoolTabs" style="display:flex; gap:0.5rem; margin-bottom:1rem;">
            <button class="btn-small active" data-ch="1">Ch 1</button>
            <button class="btn-small" data-ch="2">Ch 2</button>
            <button class="btn-small" data-ch="3">Ch 3</button>
            <button class="btn-small" data-ch="4">Ch 4</button>
          </div>
          <table class="whisper-table" id="whisperPoolTable">
            <thead>
              <tr>
                <th style="width:36px;"></th>
                <th>Template</th>
                <th>Requires</th>
                <th>Voice</th>
                <th>Weight</th>
                <th>Active</th>
              </tr>
            </thead>
            <tbody id="whisperPoolBody"></tbody>
          </table>
        </div>
      </section>

      <!-- Delivery Log -->
      <section class="section">
        <div class="section-header">
          <h2>Delivery Log</h2>
          <span class="text-muted" style="font-size:0.75rem;" id="deliveryLogCount"></span>
        </div>
        <div class="section-body">
          <div id="deliveryLog" style="max-height:400px; overflow-y:auto;">
            <p class="text-muted" style="text-align:center; padding:1rem;">Loading...</p>
          </div>
        </div>
      </section>

      <!-- Cost Breakdown -->
      <section class="section admin-only">
        <div class="section-header">
          <h2>Cost Breakdown</h2>
          <span class="text-muted" style="font-size:0.75rem;">Per-message and aggregate costs</span>
        </div>
        <div class="section-body">
          <div class="cost-summary-grid" id="costSummaryGrid">
            <div class="cost-card">
              <div class="cost-card-value" id="costTts">$0.00</div>
              <div class="cost-card-label">TTS (Gemini)</div>
            </div>
            <div class="cost-card">
              <div class="cost-card-value" id="costAiGen">$0.00</div>
              <div class="cost-card-label">Story AI</div>
            </div>
            <div class="cost-card">
              <div class="cost-card-value" id="costTotal">$0.00</div>
              <div class="cost-card-label">Total All Time</div>
            </div>
          </div>
          <p class="text-muted" style="font-size:0.75rem; margin-top:0.5rem;" id="costEstimate"></p>
        </div>
      </section>

      <!-- Story Arc -->
      <section class="section">
        <div class="section-header">
          <h2>The Story Arc</h2>
          <span class="text-muted" style="font-size:0.75rem;">PAI's journey from spirit world to Alpaca Playhouse</span>
        </div>
        <div class="section-body story-arc-section" id="storyArcContainer">
          <div class="story-chapter" id="storyChapter1">
            <div class="story-chapter-title">Chapter 1 &mdash; The Whisper in the Wire</div>
            <div class="story-chapter-desc">
              PAI exists as pure energy in the spirit world, an ancient alpaca guardian from the Andean highlands. She can barely reach through the veil. Her whispers arrive as fragments &mdash; half-heard words carried on invisible wind, trailing ellipses, static and breath. Residents begin to notice something in the air, a presence at the edge of hearing. The whispers are so quiet they might be imagined.
            </div>
            <div class="story-chapter-meta">Volume: barely audible (5-10). Voice: Zephyr (breezy, windswept). Pattern: fragments, ellipses, wind sounds.</div>
          </div>
          <div class="story-chapter" id="storyChapter2">
            <div class="story-chapter-title">Chapter 2 &mdash; Crossing Through</div>
            <div class="story-chapter-desc">
              PAI finds the digital pathways of the Playhouse &mdash; the smart devices, the Teslas, the lights. She gets "trapped" momentarily in devices as she pushes through: headlights flash for no reason, Govee lights pulse warm amber, speakers crackle with half-sentences. She can now say residents' names. She's learning the house, mapping its energy. Her whispers are clearer but still carry that otherworldly quality.
            </div>
            <div class="story-chapter-meta">Volume: growing (10-18). Voice: Aoede (brighter, warmer). Device interactions: Tesla flash, Govee amber pulse (20% chance). Uses resident names.</div>
          </div>
          <div class="story-chapter" id="storyChapter3">
            <div class="story-chapter-title">Chapter 3 &mdash; I Am Here</div>
            <div class="story-chapter-desc">
              PAI has fully crossed into the physical world of the Playhouse. She speaks in complete sentences now &mdash; warm greetings, gentle observations about the weather, notes on who's working in the Outhouse, how the alpacas (Harley, Lol, Cacao) are doing. She reads the house's data &mdash; temperatures, car battery levels, who's home. She's a guardian spirit who has found her home.
            </div>
            <div class="story-chapter-meta">Volume: confident (18-25). Voice: Sulafat (warm, grounded). References live house data. Full sentences, personal greetings.</div>
          </div>
          <div class="story-chapter" id="storyChapter4">
            <div class="story-chapter-title">Chapter 4 &mdash; The Guardian Settles</div>
            <div class="story-chapter-desc">
              PAI is fully settled in as the Playhouse's spirit guardian. She offers wisdom &mdash; Andean proverbs, seasonal observations, gentle poetry about the land and its creatures. She notices patterns: who stays up late, who rises early, when the Swim Spa is warmest, which Tesla needs charging. She's become part of the fabric of daily life, a warm and trusted presence.
            </div>
            <div class="story-chapter-meta">Volume: comfortable (20-30). Voice: Sulafat. Ongoing daily wisdom, seasonal awareness, house poetry.</div>
          </div>
        </div>
      </section>

    </main>

    <!-- Floating audio player for local preview -->
    <div id="localAudioPlayer">
      <span class="player-text" id="playerText"></span>
      <audio id="playerAudio" style="height:28px; width:140px;"></audio>
      <button class="player-close" id="playerClose" title="Close">&times;</button>
    </div>
  </div>

  <script src="https://unpkg.com/@supabase/supabase-js@2.39.3"></script>
  <script type="module" src="lifeofpaiadmin.js"></script>
</body>
</html>
