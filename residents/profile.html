<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Profile - AlpacAPPs Residents</title>
  <link rel="icon" type="image/png" href="../favicon.png">
  <link rel="apple-touch-icon" href="../apple-touch-icon.png">
  <link rel="stylesheet" href="../spaces/styles.css?v=5">
  <link rel="stylesheet" href="../spaces/admin/styles.css?v=5">
  <link rel="stylesheet" href="../spaces/admin/manage-shared.css?v=5">
  <link rel="stylesheet" href="residents.css?v=5">
</head>
<body>
  <!-- Toast Container -->
  <div id="toastContainer" class="toast-container"></div>

  <!-- Loading overlay -->
  <div id="loadingOverlay" class="loading-overlay">
    <div class="spinner"></div>
    <p>Loading...</p>
  </div>

  <!-- Unauthorized message -->
  <div id="unauthorizedOverlay" class="loading-overlay hidden">
    <div class="unauthorized-card">
      <h2>Access Denied</h2>
      <p>Your account is not authorized to access resident features.</p>
      <div class="unauthorized-actions">
        <a href="/spaces/" class="btn-secondary">View Public Spaces</a>
        <button id="signOutBtn" class="btn-secondary">Sign Out</button>
      </div>
    </div>
  </div>

  <!-- Main app content -->
  <div id="appContent" class="hidden">
    <header>
      <div class="header-left">
        <a href="https://alpacaplayhouse.com" class="header-logo">
          <img src="https://aphrrfprbixmhissnjfn.supabase.co/storage/v1/object/public/housephotos/logos/alpaca-head-black-transparent.png" alt="AlpacAPPs" class="header-logo__icon">
          <img src="https://aphrrfprbixmhissnjfn.supabase.co/storage/v1/object/public/housephotos/logos/wordmark-black-transparent.png" alt="AlpacAPPs" class="header-logo__wordmark">
        </a>
        <span style="font-size:0.65rem;color:var(--text-muted);font-weight:400;align-self:center;margin-left:-0.25rem">v260208.41 2:27p</span>
        <span id="roleBadge" class="role-badge">Staff</span>
      </div>
      <div class="header-controls">
        <span id="userInfo" class="user-info"></span>
        <button id="headerSignOutBtn" class="btn-secondary">Sign Out</button>
      </div>
    </header>

    <div class="context-switcher hidden" id="contextSwitcher">
      <a class="context-switcher-btn active">Resident</a>
      <a href="/spaces/admin/" class="context-switcher-btn">Staff</a>
    </div>

    <!-- Tab Navigation -->
    <div class="manage-tabs" id="tabNav"></div>

    <!-- Main Content -->
    <main class="manage-content profile-page">

      <!-- Profile Header Section -->
      <section class="section">
        <div class="section-body profile-header-section">
          <div class="profile-avatar-wrapper">
            <div class="profile-avatar-large" id="profileAvatar">
              <span class="profile-avatar-initials" id="avatarInitials"></span>
            </div>
            <button class="profile-avatar-edit" id="avatarEditBtn" title="Change photo">
              <svg viewBox="0 0 20 20" fill="currentColor" width="14" height="14"><path d="M4 5a2 2 0 00-2 2v8a2 2 0 002 2h12a2 2 0 002-2V7a2 2 0 00-2-2h-1.586a1 1 0 01-.707-.293l-1.121-1.121A2 2 0 0011.172 3H8.828a2 2 0 00-1.414.586L6.293 4.707A1 1 0 015.586 5H4zm6 9a3 3 0 100-6 3 3 0 000 6z"/></svg>
            </button>
            <input type="file" id="avatarInput" accept="image/*" style="display:none">
          </div>
          <div class="profile-header-info">
            <h1 id="profileName" class="profile-name"></h1>
            <span id="profileRole" class="role-badge"></span>
            <span id="profilePronouns" class="profile-pronouns"></span>
          </div>
        </div>
      </section>

      <!-- Edit Profile Form -->
      <section class="section">
        <div class="section-header">
          <h2>Edit Profile</h2>
        </div>
        <div class="section-body">
          <div class="profile-form">
            <div class="profile-field-row">
              <div class="profile-field">
                <label for="fieldFirstName">First Name</label>
                <input type="text" id="fieldFirstName" placeholder="First name" maxlength="50">
              </div>
              <div class="profile-field">
                <label for="fieldLastName">Last Name</label>
                <input type="text" id="fieldLastName" placeholder="Last name" maxlength="50">
              </div>
            </div>
            <div class="profile-field">
              <div class="profile-field-label-row">
                <label for="fieldPronouns">Pronouns</label>
                <select class="profile-privacy-select" id="privacy_pronouns" title="Who can see this"><option value="all_guests">All Guests</option><option value="residents">Residents Only</option><option value="only_me">Only Me</option></select>
              </div>
              <input type="text" id="fieldPronouns" placeholder="e.g. they/them, she/her, he/him" maxlength="50">
            </div>
            <div class="profile-field">
              <div class="profile-field-label-row">
                <label for="fieldGender">Gender</label>
                <select class="profile-privacy-select" id="privacy_gender" title="Who can see this"><option value="all_guests">All Guests</option><option value="residents">Residents Only</option><option value="only_me">Only Me</option></select>
              </div>
              <select id="fieldGender">
                <option value="">Prefer not to say</option>
                <option value="male">Male</option>
                <option value="female">Female</option>
                <option value="non-binary">Non-binary</option>
                <option value="other">Other</option>
              </select>
            </div>
            <div class="profile-field">
              <div class="profile-field-label-row">
                <label for="fieldBio">Bio</label>
                <select class="profile-privacy-select" id="privacy_bio" title="Who can see this"><option value="all_guests">All Guests</option><option value="residents">Residents Only</option><option value="only_me">Only Me</option></select>
              </div>
              <textarea id="fieldBio" rows="3" placeholder="Tell us about yourself..." maxlength="500"></textarea>
              <span class="profile-field-hint"><span id="bioCount">0</span>/500</span>
            </div>
            <div class="profile-field">
              <div class="profile-field-label-row">
                <label for="fieldNationality">Nationality</label>
                <select class="profile-privacy-select" id="privacy_nationality" title="Who can see this"><option value="all_guests">All Guests</option><option value="residents">Residents Only</option><option value="only_me">Only Me</option></select>
              </div>
              <div class="profile-input-prefix">
                <span class="profile-input-prefix__label" id="nationalityFlag">üè≥Ô∏è</span>
                <input type="text" id="fieldNationality" placeholder="e.g. Brazilian, American" maxlength="100">
              </div>
            </div>
            <div class="profile-field">
              <div class="profile-field-label-row">
                <label for="fieldLocationBase">Location Base</label>
                <select class="profile-privacy-select" id="privacy_location_base" title="Who can see this"><option value="all_guests">All Guests</option><option value="residents">Residents Only</option><option value="only_me">Only Me</option></select>
              </div>
              <div class="profile-input-prefix">
                <span class="profile-input-prefix__label" id="locationFlag">üìç</span>
                <input type="text" id="fieldLocationBase" placeholder="e.g. Austin, TX" maxlength="100">
              </div>
            </div>
            <div class="profile-field">
              <div class="profile-field-label-row">
                <label for="fieldBirthday">Birthday</label>
                <select class="profile-privacy-select" id="privacy_birthday" title="Who can see this"><option value="all_guests">All Guests</option><option value="residents">Residents Only</option><option value="only_me">Only Me</option></select>
              </div>
              <input type="date" id="fieldBirthday">
            </div>
            <div class="profile-field">
              <div class="profile-field-label-row">
                <label for="fieldPhone">Phone</label>
                <select class="profile-privacy-select" id="privacy_phone" title="Who can see this"><option value="all_guests">All Guests</option><option value="residents">Residents Only</option><option value="only_me">Only Me</option></select>
              </div>
              <input type="tel" id="fieldPhone" placeholder="+1 (555) 123-4567" maxlength="20">
            </div>
            <div class="profile-field">
              <div class="profile-field-label-row">
                <label for="fieldPhone2">Phone 2</label>
                <select class="profile-privacy-select" id="privacy_phone2" title="Who can see this"><option value="all_guests">All Guests</option><option value="residents">Residents Only</option><option value="only_me">Only Me</option></select>
              </div>
              <input type="tel" id="fieldPhone2" placeholder="+1 (555) 123-4567" maxlength="20">
            </div>
            <div class="profile-field">
              <div class="profile-field-label-row">
                <label for="fieldWhatsApp">WhatsApp</label>
                <select class="profile-privacy-select" id="privacy_whatsapp" title="Who can see this"><option value="all_guests">All Guests</option><option value="residents">Residents Only</option><option value="only_me">Only Me</option></select>
              </div>
              <div class="profile-input-prefix">
                <span class="profile-input-prefix__label">üí¨</span>
                <input type="tel" id="fieldWhatsApp" placeholder="+1 (555) 123-4567" maxlength="20">
              </div>
            </div>
            <div class="profile-field">
              <div class="profile-field-label-row">
                <label for="fieldInstagram">Instagram</label>
                <select class="profile-privacy-select" id="privacy_instagram" title="Who can see this"><option value="all_guests">All Guests</option><option value="residents">Residents Only</option><option value="only_me">Only Me</option></select>
              </div>
              <div class="profile-input-prefix">
                <span class="profile-input-prefix__label">@</span>
                <input type="text" id="fieldInstagram" placeholder="username" maxlength="30">
              </div>
            </div>

            <!-- Custom Links -->
            <div class="profile-field">
              <div class="profile-field-label-row">
                <label>Links</label>
                <select class="profile-privacy-select" id="privacy_links" title="Who can see this"><option value="all_guests">All Guests</option><option value="residents">Residents Only</option><option value="only_me">Only Me</option></select>
              </div>
              <div id="linksContainer"></div>
              <button class="btn-small" id="addLinkBtn" type="button">+ Add Link</button>
            </div>

            <div class="profile-actions">
              <button class="btn-primary" id="saveProfileBtn" disabled>Save Profile</button>
            </div>
          </div>
        </div>
      </section>

      <!-- Vehicles Section -->
      <section class="section" id="vehiclesSection" style="display:none">
        <div class="section-header">
          <h2>My Vehicles</h2>
        </div>
        <div class="section-body">
          <div id="vehiclesContainer"></div>
        </div>
      </section>

    </main>
  </div>

  <script src="https://unpkg.com/@supabase/supabase-js@2.39.3"></script>
  <script type="module" src="profile.js"></script>
</body>
</html>
